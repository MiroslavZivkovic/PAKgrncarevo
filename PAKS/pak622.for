C=======================================================================
C
C=======================================================================
      SUBROUTINE STATOT (ELM,COR,SEX,EL,EXC,STEX,I,L,LL,SSS,AKSI)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
C OVIM PODPRIGRAMOM SE ODREDJUJU STATI$KI MOMENTI ODSE$KA ZA
C KARAKTERISTI$NE TA$KE , A ZA GLAVNE OSE
C
      COMMON /COMPRF/ YC,ZC,YI,ZI,ALFB,TK,CAPAY,CAPAZ,AREA,POVR,YM,ZM,
     1                DDELT,YP,SWO(1),OM(1),DELTAP(3),TAUTK(3),OY,OZ,
     2                NT,NELM,NTIP,NKAR,IND,INDRPR(3),KR1,NEXTR,NPRPR
      DIMENSION ELM(NELM,*),COR(NT,*),SEX(NELM,*),EL(*),
     1EXC(2,NELM,*),STEX(2,NELM,*)
C
C     DABS(X)=DDABS(X)
      IF (NELM.GT.1) GO TO 135
      SSS=0.0D0
      AKSI=1.0D0
      SEX(1,3)=1.
      SEX(1,4)=0.5*EL(1)
      STEX(1,1,2)=0.25*EL(1)*ELM(1,4)
      EXC(1,1,2)=ELM(1,4)
      RETURN
  135 IF(I.GT.0) GO TO 111
C     WRITE(3,4500)NT,NELM
C4500 FORMAT(/' ','S T A T O T'/' ','NT,NELM=',2I5)
C     WRITE(3,4501)((COR(I,J),J=1,3),I=1,NT)
C4501 FORMAT(/' ','COR(I,J)',3F10.4)
C     WRITE(3,4502)((ELM(I,J),J=1,4),I=1,NELM)
C4502 FORMAT(/' ','ELM(I,J)=',4F10.4)
C     WRITE(3,4503)(EL(I),I=1,NELM)
C4503 FORMAT(/' ','EL(I):',4F10.4)
      SSS=0.
      AKSI=1.0D0
      INDB=1
C
C     PRESECI SEGMENATA SA GLAVNIM OSAMA
C
      NEXTR = 0
      DELT2 = 2.*DDELT
C***POMOCNA STAMPA
C     WRITE(3,2022) DDELT,DELT2
C2022 FORMAT(/' ','STATOT: DDELT,DELT2 =',2D14.6)
   30 DO 100 K=1,NELM
      II=ELM(K,2)
      IK=ELM(K,3)
      IF((DABS(COR(II,L)-COR(IK,L)).LT.DDELT)) GO TO 100
      IF((COR(II,L)*COR(IK,L)).GT.0.) GO TO 100
      IF(L.EQ.2) GO TO 3
      SEX(K,3)=1.
      SEX(K,4)=EL(K)*COR(II,L)/(COR(II,L)-COR(IK,L))
C
C SMATRA SE DA NE POSTOJI EKSREMUM SMIC. NAPONA AKO JE PRESEK SA GLAVNOM
C OSOM VRLO BLIZU CVORNE TACKE SEGMENTA
C
      DD2 = EL(K) - SEX(K,4)
C ***POMOCNA STAMPA
C     WRITE(3,2020) K,SEX(K,4),DD2
C2020 FORMAT(/' ','STATOT : ELEM. BR.,SEX(K,4),DD2 =',I5,2D14.6)
C
      IF(SEX(K,4).GT.DELT2.AND.DD2.GT.DELT2) GO TO 17
      SEX(K,3) = 0.
      GO TO 100
C
    3 SEX(K,5)=1.
      SEX(K,6)=EL(K)*COR(II,L)/(COR(II,L)-COR(IK,L))
      DD2 = EL(K) - SEX(K,6)
C ***POMOCNA STAMPA
C     WRITE(3,2021) K,SEX(K,6),DD2
C2021 FORMAT(/' ','STATOT : ELEM. BR.,SEX(K,6),DD2 =',I5,2D14.6)
C
      IF(SEX(K,6).GT.DELT2.AND.DD2.GT.DELT2) GO TO 17
      SEX(K,5) = 0.
      GO TO 100
C
   17 NEXTR = NEXTR + 1
C
  100 CONTINUE
      IF(L.EQ.3) GO TO 21
      L=3
      GO TO 30
C
   21 IF(L.EQ.2) GO TO 12
      L1=1
      GO TO 13
   12 L1=2
   13 NBR=1
      DO 110 K=1,NELM
      DO 140 K1=1,3
      KK=2*K1-1
      IF(DABS(SEX(K,KK)).LT.1.0D-20) GO TO 140
      II=ELM(K,2)
      IK=ELM(K,3)
      NBR=1
      YP=COR(II,L)+(COR(IK,L)-COR(II,L))/EL(K)*SEX(K,KK+1)
C
C  AKO JE SEGMENT SA EXTREM. NAPONOM PARALELAN SA OSOM - NAPON SMICANJA
C  OD TRANSV. SILE SE ZANEMARUJE (STEX(L1,K,K1) = 0.)
C
      IF(DABS(YP-COR(II,L)).LE.DDELT. AND .DABS(YP-COR(IK,L)).LE.DDELT)
     1 GO TO 140
C
C     IF((K.EQ.2.OR.K.EQ.4).AND.L.EQ.3) WRITE(3,5000) K,KK,L,YP,SEX(
C    1 K,KK+1)
C5000 FORMAT(/2X,'YP U PETLJI 110 : K,KK,L,YP,SEX(K,KK+1) =',3I5,3D12.5)
      AKSI=0.
      DO 2 J=1,NELM
      I1=ELM(J,2)
      I2=ELM(J,3)
      IF((DABS(COR(I1,L)-YP).LT.DDELT).AND.(DABS(
     1COR(I2,L)-YP).LT.DDELT)) GO TO 5
      IF((COR(I1,L).GT.YP).AND.(COR(I2,L).LT.YP)) GO TO 11
      IF((COR(I1,L).LT.YP).AND.(COR(I2,L).GT.YP)) GO TO 11
      GO TO 2
C  11 AKSI=AKSI+ELM(J,4)*EL(J)/(DABS(COR(I1,L)-
C    1COR(I2,L)))
   11 AKSI=AKSI+ELM(J,4)
       GO TO 2
    5 AKSI=AKSI+EL(J)
    2 CONTINUE
      EXC(L1,K,K1)=AKSI
C
C  IZLAZI IZ PETLJE 140 NA LABELU 112 A ZATIM SE VRACA
C
      GO TO 112
C
C 150 CONTINUE
  140 CONTINUE
  110 CONTINUE
C
  150 GO TO 151
C 111 YP=COR(I,L)
  111 AKSI = 0.
      SSS = 0.
      NBR=0
C
  112 DO 101 J=1,NELM
      II=ELM(J,2)
      IK=ELM(J,3)
      IF((DABS(COR(II,L)-YP).LE.DDELT).AND.(DABS(COR(IK,L)-YP).LE.DDELT) 
     1)GO TO 120
      IF((COR(II,L).GT.YP).AND.(COR(IK,L).GT.YP)) GO TO 102
      IF((DABS(COR(II,L)-YP).LE.DDELT).AND.(COR(IK,L).GT.YP)) GO TO 102
      IF((DABS(COR(IK,L)-YP).LE.DDELT).AND.(COR(II,L).GT.YP)) GO TO 102
      IF((COR(II,L).GT.YP).AND.(COR(IK,L).LT.YP)) GO TO 113
      IF((COR(IK,L).GT.YP).AND.(COR(II,L).LT.YP)) GO TO 121
      GO TO 101
C
C     SEGMENT JE NA Y=YP
C
  120 IF(NBR.EQ.1) GO TO 1
      IF(LL.EQ.0) GO TO 101
      GO TO 4
    1 STEX(L1,K,K1)=STEX(L1,K,K1)+YP*EL(J)*ELM(J,4)
C     IF((K.EQ.2.OR.K.EQ.4).AND.L.EQ.3) WRITE(3,5002) K,K1,J,L,L1,YP,
C    1 STEX(L1,K,K1)
C5002 FORMAT(/2X,'SEGMENT PARAL.SA OSOM:  K,K1,J,L,L1,YP,STEX(L1,K,K1)'
C    1 ,5I5,2D12.5)
      GO TO 101
    4 SSS=SSS+YP*EL(J)*ELM(J,4)
      GO TO 101
C
C     SEGMENT JE IZNAD YP
C
  102 SYZ=0.5*EL(J)*(COR(II,L)+COR(IK,L))*ELM(J,4)
      IF(NBR.EQ.0) GO TO 6
C     IF((K.EQ.2.OR.K.EQ.4).AND.L.EQ.3) WRITE(3,5003) K,K1,J,L,L1,YP,
C    1 SYZ
C5003 FORMAT(/2X,'SEGMENT IZNAD ILI ISPOD: K,K1,J,L,L1,YP,SYZ'
C    1 ,5I5,2D12.5)
      STEX(L1,K,K1)=STEX(L1,K,K1)+SYZ
      GO TO 101
    6 SSS=SYZ+SSS
      GO TO 101
C
C     SEGMENT JE PRESE$EN SA Y=YP
C
  113 SYZ=(YP-COR(II,L))/(COR(IK,L)-COR(II,L))*EL(J)*ELM(J,4)
     1*0.5*(COR(II,L)+YP)
      GO TO 7
  121 SYZ=(1.-(YP-COR(II,L))/(COR(IK,L)-COR(II,L)))*EL(J)*ELM(J,4)
     1*0.5*(COR(IK,L)+YP)
    7 IF(NBR.EQ.0) GO TO 8
C     IF((K.EQ.2.OR.K.EQ.4).AND.L.EQ.3) WRITE(3,5004) K,K1,J,L,L1,YP,
C    1 SYZ
C5004 FORMAT(/2X,'SEGMENT PRESECEN SA YP: K,K1,J,L,L1,YP,SYZ'
C    1 ,5I5,2D12.5)
      STEX(L1,K,K1)=STEX(L1,K,K1)+SYZ
      GO TO 101
    8 SSS=SSS+SYZ
      AKSI = AKSI + ELM(J,4)
C
  101 CONTINUE
C
      IF(NBR.EQ.1) GO TO 150
      IF(I.GT.0)RETURN
  151 IF(INDB.EQ.2)RETURN
      IF(L.EQ.2) GO TO 20
      L=2
      INDB=2
      GO TO 21
   20 L=3
      INDB=2
      GO TO 21
C
      END
      SUBROUTINE STASEG(ELM,COR,CORK,SEX,EXC,STEX,EL,NELP,SZ,CSI)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
C  PODPROGRAM ZA ODREDJIVANJE STAT. MOMENATA I SIRINA PRESEKA PO SEGMEN
C  TIMA, U CVORNIM TACKAMA SEGMENATA
C
      COMMON /PGREDC/ NPUN,NPRBR,MAXPRR,NPRES,ICV1,ICV2,MATG,
     1                NKARD,MG,NVR,NWRITE,NAPG,INDOF
      COMMON /COMPRF/ YC,ZC,YI,ZI,ALFB,TK,CAPAY,CAPAZ,AREA,POVR,YM,ZM,
     1                DDELT,YP,SWO(1),OM(1),DELTAP(3),TAUTK(3),OY,OZ,
     2                NT,NELM,NTIP,NKAR,IND,INDRPR(3),KR1,NEXTR,NPRPR
C
      DIMENSION COR(NT,*),ELM(NELM,*),CORK(NKARD,*),SEX(NELM,*),EXC(2,
     1 NELM,*),STEX(2,NELM,*),EL(*),NELP(3,*),SZ(NELM,*),CSI(NELM,
     2 *)
C
C     DABS(X) = DDABS(X)
      AXF(Z1,Y1,Z2,Y2,ZK,YK) = (Z1 - ZK)*(Y2 - YK) - (Y1 -YK)*(Z2 - ZK)
C
      DELT2 = 2.*DDELT
      SSS=0.0D0 
C
C  PETLJA PO SEGMENTIMA
C
      DO  210 NSE = 1,NELM
      I1 = ELM(NSE,2)
      I2 = ELM(NSE,3)
      Z1 = COR(I1,2)
      Z2 = COR(I2,2)
      Y1 = COR(I1,3)
      Y2 = COR(I2,3)
C
C ODREDJIVANE ZNAKOVA ZA SMICUCE NAPONE TZ I TY OD TRANSV. SILA
C
      IF(DABS(Y2-Y1).LE.DDELT) GO TO 40
      IF(DABS(Z2-Z1).LE.DDELT) GO TO 50
C
C  SEGMENT JE KOS U ODNOSU NA GLAVNE OSE
C
      IF(Y2-Y1) 15,15,10
   10 IF(Z2-Z1) 25,25,20
   20 SZ(NSE,5) = 1.
      SZ(NSE,6) = 1.
      GO TO 60
   25 SZ(NSE,5) = -1.
      SZ(NSE,6) = 1.
      GO TO 60
   15 IF(Z2-Z1) 30,30,28
   28 SZ(NSE,5) = 1.
      SZ(NSE,6) = -1.
      GO TO 60
   30 SZ(NSE,5) = -1.
      SZ(NSE,6) = -1.
      GO TO 60
C
C  SEGMENT JE NA OSI 1
C
   40 SZ(NSE,6) = 0.
      IF(Z2-Z1) 44,44,42
   42 SZ(NSE,5) = 1.
      GO TO 60
   44 SZ(NSE,5) = -1.
      GO TO 60
C
C  SEGMENT JE NA OSI 2
C
   50 SZ(NSE,5) = 0.
      IF(Y2-Y1) 54,54,52
   52 SZ(NSE,6) = 1.
      GO TO 60
   54 SZ(NSE,6) = -1.
C
C  VELICINE STAT. MOMENATA I SIRINA PRESEKA U CVOROVIMA SEGMENATA
C
   60 ICV = 1
C
   80 DO 200 L = 2,3
C
      GO TO (81,82),ICV
   81 IF(L.EQ.3) GO TO 83
      KOL = 2
      GO TO 86
   83 KOL = 1
      GO TO 86
   82 IF(L.EQ.3) GO TO 84
      KOL = 4
      GO TO 86
   84 KOL = 3
C
   86 IF(DABS(COR(I1,L)-COR(I2,L)).GT.DDELT) GO TO 100
C
C  SEGMENT JE NA OSI - STAT. MOMENT SE UZIMA = 0., A SIRINA AKSI=1000.
C
      GO TO 200
C
C  VELICINA KOORDINATE YP (UNUTAR SEGMENTA)
C
  100 GO TO (120,140),ICV
C
  120 IF(COR(I2,L)-COR(I1,L)) 125,125,130
  125 YP = COR(I1,L) - DELT2
      GO TO 160
  130 YP = COR(I1,L) + DELT2
      GO TO 160
C
  140 IF(COR(I2,L)-COR(I1,L)) 145,145,150
  145 YP = COR(I2,L) + DELT2
      GO TO 160
  150 YP = COR(I2,L) - DELT2
C
C  STATICKI MOMENT ODSECKA I SIRINA PRESEKA
C
  160 LL = 1
      IF(YP.LT.0.) LL = 0
C     WRITE(3,1500) NSE,LL,KOL,DELT2,DDELT,YP
C1500 FORMAT(/2X,'STASEG ---  NSE,LL,KOL,DELT2,DDELT,YP=',3I5,3D14.6)
C
      CALL STATOT (ELM,COR,SEX,EL,EXC,STEX,1,L,LL,SSS,AKSI)
C
      SZ(NSE,KOL) = SSS
      CSI(NSE,KOL) = AKSI
C
  200 CONTINUE
C
      IF(ICV.EQ.2) GO TO 210
      ICV = 2
      GO TO 80
C
  210 CONTINUE
C
      IF(NTIP.EQ.1) RETURN
C
C  ODREDJIVANJE ZNAKA ZA SMICUCE NAPONE TORZIJE ZA ZATVORENE PRESEKE
C
      IF(NKAR.EQ.2) GO TO 300
C
C  JEDNOSTRUKO POVEZAN PRESEK
C
      DO 230 NSE = 1,NELM
      I1 = ELM(NSE,2)
      I2 = ELM(NSE,3)
      AX = AXF(COR(I1,2),COR(I1,3),COR(I2,2),COR(I2,3),CORK(1,2),CORK(
     1         1,3))
C
      IF(AX) 211,211,212
  211 SZ(NSE,7) = -1.
      GO TO 230
  212 SZ(NSE,7) = 1.
C
  230 CONTINUE
C
      RETURN
C
C  DVOSTRUKO POVEZAN PRESEK
C
C  GRANE 1 I 2 (KONTURNE)

C
  300 DO 350 N = 1,2
      NN = INDRPR(N)
      DO 350 I =1,NN
      NSE = NELP(N,I)
      I1 = ELM(NSE,2)
      I2 = ELM(NSE,3)
C
      AX = AXF(COR(I1,2),COR(I1,3),COR(I2,2),COR(I2,3),CORK(N,2),
     1          CORK(N,3))
C
      IF(AX) 240,240,241
  240 SZ(NSE,7) = -1.
      GO TO 350
  241 SZ(NSE,7) = 1.
C
  350 CONTINUE
C
C  SREDNJA GRANA (REBRO) - 3

C
      NN = INDRPR(3)
      DO 380 I = 1,NN
      NSE = NELP(3,I)
      I1 = ELM(NSE,2)
      I2 = ELM(NSE,3)
      IF(I1.NE.KR1. AND .I2.NE.KR1) GO TO 380
      IF(I1.EQ.KR1) GO TO 385
      I2 = I1
      I1 = KR1
      GO TO 385
  380 CONTINUE
C
  385 AXR= AXF(COR(I1,2),COR(I1,3),COR(I2,2),COR(I2,3),CORK(1,2),
     1          CORK(1,3))
      DO 400 I =1,NN
      NSE = NELP(3,I)
      I1 = ELM(NSE,2)
      I2 = ELM(NSE,3)
C
      AX = AXF(COR(I1,2),COR(I1,3),COR(I2,2),COR(I2,3),CORK(1,2),
     1          CORK(1,3))
C
      IF((AXR.GT.0..AND.AX.GT.0.) .OR. (AXR.LT.0..AND.AX.LT.0))GO TO 390
      SZ(NSE,7) = -1.
      GO TO 400
  390 SZ(NSE,7) = 1.
C
  400 CONTINUE
C
C  ZAPISIVANJE PRIPADANJA SEGMENATA PO GRANAMA U OSMU KOLONU MATRICE
C  SZ(NELM,8)
C
      DO 420 I = 1,3
      NN = INDRPR(I)
      DO 420 J = 1,NN
      NSE = NELP(I,J)
      SZ(NSE,8) = I
  420 CONTINUE
C
      RETURN
C
      END
      SUBROUTINE PRINPR(ELM,SZ,STEX,CSI,EXC,SEX,NT,NELM,NEXTR)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
C
C  PODPROGRAM ZA STAMPANJE STATICKIH MOMENATA ODSECAKA I SIRINA PRESEKA
C  ZA TACKE PRESEKA I TACKE EKSTREMUMA
C
      DIMENSION  ELM(NELM,*),SZ(NELM,*),STEX(2,NELM,*),CSI(NELM,*),
     1 EXC(2,NELM,*),SEX(NELM,*)
      NT=NT
C
C  STAMPANJE REZULTATA
C
      NEXTR=0
      WRITE(3,2001)
 2001 FORMAT(//11X,'SMICUCI NAPONI OD TRANSVERZALNIH SILA'
     1//11X,'1. CVORNE TACKE SEGMENATA'//11X,'SMICAN',
     2'JE OD TRANSVERZALNIH SILA U PRAVCU GLAVNIH OSA'/18X,
     3'OD SILE U PRAVCU OSE',14X,'OD SILE U PRAVCU OSE 2'//
     3'SEGM. TACKA  STAT.MOM.ODSECKA  ',
     4'SIRINA PRESEKA  STAT.MOM.ODSECKA SIRINA PRESEKA')
C
      DO 10 NSE = 1,NELM
      I1 = ELM(NSE,2)
      I2 = ELM(NSE,3)
      WRITE(3,2002)NSE,I1,SZ(NSE,2),CSI(NSE,2),SZ(NSE,1),CSI(NSE,1)
      WRITE(3,2003)I2,SZ(NSE,4),CSI(NSE,4),SZ(NSE,3),CSI(NSE,3)
   10 CONTINUE
C
 2002 FORMAT(I3,1X,I5,6X,1PD12.5,6X,1PD12.5,4X,1PD12.5,5X,1PD12.5)
 2003 FORMAT(4X,I5,6X,1PD12.5,6X,1PD12.5,4X,1PD12.5,5X,1PD12.5)
C
C  ZA EKSTREMNE VREDNOSTI SMICUCEG NAPONA
C
      WRITE(3,2010)
 2010 FORMAT(//3X,'2. ZA EKSTREMNE VREDNOSTI SMICUCEG NAPONA',1X,
     1'- TACKE PRESEKA SA GLAVNIM OSAMA')
      IF(NEXTR.GT.0) GO TO 17
      WRITE(3,2008)
 2008 FORMAT(/'   NEMA EKSTREMUMA SMICUCEG NAPONA (AKO POSTOJE - ONDA', 
     1' SU U CVORNIM TACKAMA PRESEKA)')
      RETURN
C
   17 WRITE(3,2004)
 2004 FORMAT(2X,'(AKO PRESEK LEZI NA OSI',
     1'- SMIC. NAPON OD SILE UPRAVNE NA SEGM. SE ZANEMARUJE)',/
     2'    SMICUCI NAPONI OD TRANSV. SILE U PRAVCU OSE 1   I  ',
     3' SILE U PRAVCU OSE 2',
     2//'SEGMENT  UDALJENOST OD      STATICKI        SIRINA       ',
     3'STATICKI       SIRINA'/,10X,'PRVE TACKE          MOMENT      ',
     4' PRESEKA         MOMENT      PRESEKA'/)
C
      NEXTR1 = 0
      DO 20 NSE = 1,NELM                          
      IF(DABS(SEX(NSE,3)).LT.1.0D-20) GO TO 20
      NEXTR1 = 1
   20 CONTINUE
C
      IF(NEXTR1.GT.0) GO TO 25
      WRITE(3,2011)
 2011 FORMAT(13X,'NEMA PRESEKA SA OSOM - 1 - NA KONACNOM UDALJENJU OD CV
     1OVA')
      GO TO 30
C
   25 WRITE(3,2012)
 2012 FORMAT(23X,'TACKE PRESEKA SA OSOM - 1 -')
C
      DO 27 NSE = 1,NELM
      IF(DABS(SEX(NSE,3)).LT.1.0D-20) GO TO 27
      WRITE(3,2006)NSE,SEX(NSE,4),STEX(2,NSE,2),EXC(2,NSE,2),STEX(1,NSE,
     1 2),EXC(1,NSE,2)
   27 CONTINUE
 2006 FORMAT(I5,5X,1PD12.5,1X,1PD13.5,1X,1PD13.5,2X,2(1PD13.5))
C
   30 NEXTR1 = 0
      DO 35 NSE = 1,NELM
      IF(DABS(SEX(NSE,5)).LT.1.0D-20) GO TO 35
      NEXTR1 = 1
   35 CONTINUE
C
      IF(NEXTR1.GT.0) GO TO 40
C
      WRITE(3,2013)
 2013 FORMAT(13X,'NEMA PRESEKA SA OSOM - 2 - NA KONACNOM UDALJENJU OD CV
     1OVA')
      RETURN
C
   40 WRITE(3,2007)
 2007 FORMAT(/23X,'TACKE PRESEKA SA OSOM - 2 -')
C
      DO 47 NSE = 1,NELM
      IF(DABS(SEX(NSE,5)).LT.1.0D-20) GO TO 47
      WRITE(3,2006)NSE,SEX(NSE,6),STEX(2,NSE,3),EXC(2,NSE,3),STEX(1,NSE,
     1 3),EXC(1,NSE,3)
   47 CONTINUE
C
      RETURN
C
      END
